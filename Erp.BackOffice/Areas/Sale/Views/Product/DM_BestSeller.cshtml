@using Erp.BackOffice.App_GlobalResources
@using Erp.BackOffice.Helpers
@using Erp.BackOffice.Sale.Models
@using Erp.Domain.Sale.Entities
@using GridMvc.Html

@model DM_BEST_SELLERViewModel

@{
    ViewBag.Title = "Danh mục Best Seller";
    bool isPopup = Request["IsPopup"] != null && Request["IsPopup"].ToString().ToLower() == "true" ? true : false;
    if (isPopup)
    {
        Layout = "~/Views/Shared/_PopupLayout.cshtml";
    }
    else
    {
        Layout = "~/Views/Shared/ACE_AdminLayout.cshtml";
    }
    var jsCallback = Request["jsCallback"] == null ? "" : Request["jsCallback"].ToString();
    Erp.BackOffice.Models.PageSetting pageSetting = new Erp.BackOffice.Models.PageSetting
    {
        ModuleName = "Product",
        ActionName = "DM_BestSeller",
        PageTitle = ViewBag.Title,
        DisplaySearchPanel = false,
        IsPopup = false,
        DisplayBackButton = false
    };
    var orderNo = 0;
    IEnumerable<ProductViewModel> productList = (IEnumerable<ProductViewModel>)ViewBag.ProductList;

}

<link href="@Url.Content("~/assets/css/Gridmvc.css")" rel="stylesheet" type="text/css" />
<script src="@Url.Content("~/Scripts/gridmvc.min.js")" type="text/javascript"> </script>

<style type="text/css">

</style>
@using (Html.BeginPageHeaderContainer(pageSetting))
{
    <input type="hidden" value="@Request["IsPopup"]" name="IsPopup" />
    <input type="hidden" value="@Request["jsCallback"]" name="jsCallback" />
}

@if (ViewBag.SuccessMessage != null && ViewBag.SuccessMessage != "")
{
    <div class="alert alert-block alert-success">
        <button class="close" data-dismiss="alert" type="button">
            <i class="icon-remove"></i>
        </button>
        <i class="ace-icon fa fa-check green"></i>
        @ViewBag.SuccessMessage
    </div>
}

@if (ViewBag.FailedMessage != null && ViewBag.FailedMessage != "")
{
    <div class="alert alert-block alert-error">
        <button class="close" data-dismiss="alert" type="button">
            <i class="icon-remove"></i>
        </button>
        <i class="icon-warning-sign red"></i>
        @ViewBag.FailedMessage
    </div>
}

@if (ViewBag.AlertMessage != null && ViewBag.AlertMessage != "")
{
    <div class="alert alert-block alert-success">
        <button class="close" data-dismiss="alert" type="button">
            <i class="icon-remove"></i>
        </button>
        <i class="ace-icon fa fa-check green"></i>
        @ViewBag.AlertMessage
    </div>
}

@helper GridColumnCommand(int id)
{
    <div class="hidden-phone visible-desktop action-buttons">
        @using (Html.BeginForm("DeleteBestSeller", "Product", FormMethod.Post))
        {
            if (Erp.BackOffice.Filters.SecurityFilter.AccessRight("DeleteBestSeller", "Product", "Sale"))
            {
                <a href="@Url.Action("DeleteBestSeller", "Product", new {area = "Sale",  id = id })" class="btn btn-minier btn-danger" onclick="return confirm('Bạn có muốn xóa dữ liệu không ?');" style="margin-top:-3px">
                    <i class="ace-icon fa fa-trash"></i>
                    Xóa
                </a>
            }
        }
    </div>
}

@helper RenderEditItem(int id,int productid, int is_show)
{

}

@helper isshow(int id, int is_show)
{
    <label>
        <input id="is_show_table" class="ace class-is-show text-center" type="checkbox" name="is-show-table" value="@is_show" checked="@(is_show == 1? "checked":null)">
        <span class="lbl"></span>
    </label>
}

@using (Html.BeginForm("CreateBestSeller", "Product", FormMethod.Post, new { enctype = "multipart/form-data" }))
{
    @Html.ValidationSummary(true)

    @Html.HiddenFor(model => model.CreatedUserId)
    @Html.HiddenFor(model => model.CreatedDate)
    @Html.HiddenFor(model => model.IsDeleted)
    @Html.HiddenFor(model => model.BEST_SELLER_ID)
    
    <hr />
    <div class="widget-box">
        <div class="widget-header text-center">
            <span style="color:black;font-weight:bold">Tạo mới Best Seller</span>
        </div>
        <div class="widget-body">
            <div>
                <div class="product-search-box">
                    @Html.TextBoxFor(model => model.STT, new { @class = "", autocomplete = "off", @placeholder = "STT", @Value = (@Model.STT == 0) ? "" : @Model.STT.ToString() })
                    <input id="Product_Id" name="Product_Id" type="text" hidden />
                    <input id="Product_Name" name="Product_Name" style="width:300px" type="text" placeholder="Tên sản phẩm..." autocomplete="off" />&nbsp
                    <select id="productSelectList" name="productSelectList" style="width:400px">
                        <option value="">- Tìm sản phẩm -</option>
                        @foreach (var item in productList.OrderBy(x => x.Name))
                        {
                            <option value="@item.Id" data-selected="0" data-value="@item.Id | @(Common.KiemTraTonTaiHinhAnh(item.Image_Name,"product-image-folder","product"))  | @(item.Code + " - " + item.Name)" data-code="@item.Code">@item.Code - @item.Name</option>
                        }
                    </select>
                </div>
                
            </div>
     </div>
        @if (Erp.BackOffice.Filters.SecurityFilter.AccessRight("CreateBestSeller", "Product", "Sale"))
        {
        <button id="Create" name="Create" value="Create" type="submit" class="btn btn-mini btn-primary" href="@Url.Action("CreateBestSeller", pageSetting.ModuleName)">
            <i class="ace-icon fa fa-plus"></i>
            @Wording.CreateNew
        </button>
        }
    </div>

}

<hr/>

@using (Html.BeginForm("EditBestSeller", "Product", FormMethod.Post, new { enctype = "multipart/form-data" }))
{ 
<table class="table table-striped table-bordered table-hover">
    <thead>
        <tr>
            <th width="10px">#</th>
            <th style="width:250px">Tên sản phẩm</th>
            <th style="width:10px">Thứ tự</th>
            <th style="width:10px">Hiện</th>
            <th style="width:10px">xóa</th>
        </tr>
    </thead>
    <tbody>
        @if (Model.bestsellerList != null)
        {
            <tr role="0" data-id="0" hidden>
                <td>
                    <input hidden class="BEST_SELLER_ID" id="bestsellerList_0__BEST_SELLER_ID" name="bestsellerList[0].BEST_SELLER_ID" value="0" />
                </td>
                <td>
                    <input hidden class="Product_Id" id="bestsellerList_0__Product_Id" name="bestsellerList[0].Product_Id" value="0" />
                </td>
                <td>
                    <input class="item_stt" id="bestsellerList_0__STT" name="bestsellerList[0].STT" value="0" />
                </td>
                <td>
                    <label>
                        <input id="bestsellerList_0__IS_SHOW" class="ace item_is_show text-center" type="checkbox" name="bestsellerList[0].IS_SHOW" value="0">
                        <span class="lbl"></span>
                    </label>
                </td>
                <td></td>
            </tr>
            for (int i = 0; i < Model.bestsellerList.Count(); i++)
            {
                orderNo++;
                <tr role="@(i+1)" id="@(i+1)">
                    <td>
                        @orderNo
                        <input hidden class="BEST_SELLER_ID" id="bestsellerList_@(i+1)__BEST_SELLER_ID" name="bestsellerList[@(i+1)].BEST_SELLER_ID" value="@Model.bestsellerList[i].BEST_SELLER_ID" />
                    </td>
                    <td>
                        <input hidden class="Product_Id" id="bestsellerList_@(i+1)__Product_Id" name="bestsellerList[@(i+1)].Product_Id" value="@Model.bestsellerList[i].Product_Id" />
                        <span>@Model.bestsellerList[i].ProductName</span>
                    </td>
                    <td>
                        <input class="item_stt" id="bestsellerList_@(i+1)__STT" name="bestsellerList[@(i+1)].STT" value="@Model.bestsellerList[i].STT" />
                    </td>
                    <td>
                        <label>
                            <input id="bestsellerList_@(i+1)__IS_SHOW" class="ace item_is_show text-center" type="checkbox" name="bestsellerList[@(i+1)].IS_SHOW" value="@Model.bestsellerList[i].IS_SHOW" checked="@(Model.bestsellerList[i].IS_SHOW == 1 ? "checked" : null)" onclick="isshowcheck(@(i+1))">
                            <span class="lbl"></span>
                        </label>
                    </td>
                    <td>@GridColumnCommand(Model.bestsellerList[i].BEST_SELLER_ID)</td>
                </tr>
            }
        }
    </tbody>
</table>
    using (Html.BeginButtonContainer(pageSetting))
    {
        <button class="btn btn-mini btn-primary" type="submit" name="Submit" value="Save">
            <i class="ace-icon fa fa-save"></i>
            @Wording.Save
        </button>
    }
}



@section Scripts {
@Html.ScriptBottom_ValidationMvc()
@Html.ScriptBottom_ChosenStyle()
@Html.ScriptBottom_DatePicker("dd/MM/yyyy")

<link href="/Scripts/RadCombobox_v1/RadComboBoxLite.css" rel="stylesheet" />
<script src="/Scripts/RadCombobox_v1/rabCombobox.js"></script>
    <script type="text/javascript">

        $(document).ready(function () {

            //init rcb chọn sản phẩm
            $('#productSelectList').radComboBox({
                colTitle: 'ID, Hình, Tên sản phẩm',
                colValue: 1,
                colImage: 2,
                colHide: '1',
                colSize: '0px,70px',
                colClass: ',,',
                //width: 600,
                height: 300,
                boxSearch: true,
                colSearch: 2
            });


            $('#productSelectList').on('change', function () {
                var $this = $(this);
                var selected = $this.find("option:selected");

                if (selected.val() == '' || $('#product_item_' + selected.val()).length > 0)
                    return;
                $("#Product_Id").val(selected.val());
                $("#Product_Name").val(selected.text());
            });

        });

        function isshowcheck(i) {
            if ($("#bestsellerList_" + i + "__IS_SHOW").is(':checked') == true) {
                $("#bestsellerList_" + i + "__IS_SHOW").val("1");
            }
            else {
                $("#bestsellerList_" + i + "__IS_SHOW").val("0");
            }
        }
    </script>
}
