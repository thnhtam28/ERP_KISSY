@using Erp.BackOffice.App_GlobalResources
@using Erp.BackOffice.Helpers
@using Erp.BackOffice.Sale.Models
@using Erp.BackOffice.Account.Models
@using PagedList;
@using PagedList.Mvc;
@model PagedList.IPagedList<InventoryViewModel>
    @{
        Layout = null;

    }
    @section HeadOfPage {
        @Html.ScriptTop_ChosenStyle()
        <style type="text/css">
            .imgproduct :hover {
                border-color: antiquewhite;
            }
        </style>
    }

    @*<table class="table table-bordered">
            <thead>
                <tr>
                    <th>Id</th>
                    <th>Name</th>
                </tr>
            </thead>
            <tbody id="tblData"></tbody>
        </table>
        <div id="paged">

        </div>*@

    @foreach (var item in Model)
    {
        <a class="imgproduct col-sm-6" href="javascript:getdataimg(@item.ProductId,'@item.ProductName','@item.ProductUnit',@(item.ProductPriceOutbound),'@item.CategoryCode','@item.ProductCode',@(item.Quantity==null?0:item.Quantity.Value),'@item.LoCode','@(item.ExpiryDate==null?"":item.ExpiryDate.Value.ToString("dd/MM/yyyy"))',@item.TaxFee)" data-id="@item.ProductId" value="@item.Id" data-selected="0" data-value="@item.Id | @(Erp.BackOffice.Helpers.Common.KiemTraTonTaiHinhAnh(item.Image_Name,"product-image-folder","product")) | @(item.ProductCode + " - " + item.ProductName)|@item.LoCode|@(item.ExpiryDate==null?"":item.ExpiryDate.Value.ToShortDateString())|@item.Origin|@(Common.PhanCachHangNgan(item.Quantity))" data-code="@item.ProductCode" data-lo-code="@item.LoCode" data-expiry-date="@(item.ExpiryDate==null?"":item.ExpiryDate.Value.ToString("dd/MM/yyyy"))" data-product-type="@item.CategoryCode" data-price="@(item.ProductPriceOutbound)" data-unit="@item.ProductUnit" data-product-name="@item.ProductName" data-product-id="@item.ProductId" data-quantity-inventory="@(item.Quantity==null?0:item.Quantity.Value)" data-origin="@item.Origin" data-tax-fee="@item.TaxFee" style="font-weight:700;background-size:100% 100%;background-image:url(@Erp.BackOffice.Helpers.Common.KiemTraTonTaiHinhAnh(item.Image_Name,"product-image-folder","product")); width:17%;height:150px;float:left;margin:5px;">
            @item.ProductName
        </a>
    }
    <div class="pagination" id="myPager">
        Page @(Model.PageCount < Model.PageNumber ? 0 : Model.PageNumber)
        of @Model.PageCount   @Html.PagedListPager(Model, page => Url.Action("SearchProductInvoice2", new { Search = ViewBag.Search, page }))
    </div>



    <script>
        function GetPageData(pageNum, pageSize) {
            //alert("da goi vao");
            //After every trigger remove previous data and paging
            $("#tblData").empty();
            $("#paged").empty();
            $.getJSON("/ProductInvoice/SearchProductControl", { pageNumber: pageNum, pageSize: pageSize }, function (response) {
                var rowData = "";
                for (var i = 0; i < response.Data.length; i++) {
                    rowData = rowData + '<tr><td>' + response.Data[i].Id + '</td><td>' + response.Data[i].ProductName + '</td></tr>';
                }
                $("#tblData").append(rowData);
                PaggingTemplate(response.TotalPages, response.CurrentPage);
            });
        }
        //Start Pagination
        //This is paging temlpate ,you should just copy paste
        function PaggingTemplate(totalPage, currentPage) {
            var template = "";
            var TotalPages = totalPage;
            var CurrentPage = currentPage;
            var PageNumberArray = Array();


            var countIncr = 1;
            for (var i = currentPage; i <= totalPage; i++) {
                PageNumberArray[0] = currentPage;
                if (totalPage != currentPage && PageNumberArray[countIncr - 1] != totalPage) {
                    PageNumberArray[countIncr] = i + 1;
                }
                countIncr++;
            };
            PageNumberArray = PageNumberArray.slice(0, 5);
            var FirstPage = 1;
            var LastPage = totalPage;
            if (totalPage != currentPage) {
                var ForwardOne = currentPage + 1;
            }
            var BackwardOne = 1;
            if (currentPage > 1) {
                BackwardOne = currentPage - 1;
            }

            template = "<p>" + CurrentPage + " of " + TotalPages + " pages</p>"
            template = template + '<ul class="pager">' +
                '<li class="previous"><a href="#" onclick="GetPageData(' + FirstPage + ')"><i class="fa fa-fast-backward"></i>&nbsp;First</a></li>' +
                '<li><select ng-model="pageSize" id="selectedId"><option value="20" selected>20</option><option value="50">50</option><option value="100">100</option><option value="150">150</option></select> </li>' +
                '<li><a href="#" onclick="GetPageData(' + BackwardOne + ')"><i class="glyphicon glyphicon-backward"></i></a>';

            var numberingLoop = "";
            for (var i = 0; i < PageNumberArray.length; i++) {
                numberingLoop = numberingLoop + '<a class="page-number active" onclick="GetPageData(' + PageNumberArray[i] + ')" href="#">' + PageNumberArray[i] + ' &nbsp;&nbsp;</a>'
            }
            template = template + numberingLoop + '<a href="#" onclick="GetPageData(' + ForwardOne + ')" ><i class="glyphicon glyphicon-forward"></i></a></li>' +
                '<li class="next"><a href="#" onclick="GetPageData(' + LastPage + ')">Last&nbsp;<i class="fa fa-fast-forward"></i></a></li></ul>';
            $("#paged").append(template);
            $('#selectedId').change(function () {
                GetPageData(1, $(this).val());
            });
        }
        ////End Pagination
        //function getdataimg(ProductId, ProductName, Unit, Price, ProductType, ProductCode, QuantityInventory, LoCode, ExpiryDate, TaxFee) {

        //    var $this = $(this);
        //    if (tab3 == 0 && tab1 == 1 && tab2 == 0) {
        //        var OrderNo = $('.detailList1 tr').length;
        //        var Istab = 1;
        //    } else if (tab3 == 0 && tab1 == 0 && tab2 == 1) {
        //        var OrderNo = $('.detailList2 tr').length;
        //        var Istab = 2;
        //    } else {
        //        var OrderNo = $('.detailList3 tr').length;
        //        var Istab = 3;
        //    }
        //    var Quantity = 1;
        //    var formdata = {
        //        OrderNo: OrderNo,
        //        ProductId: ProductId,
        //        ProductName: ProductName,
        //        Unit: Unit,
        //        Quantity: Quantity,
        //        Price: Price,
        //        ProductCode: ProductCode,
        //        ProductType: ProductType,
        //        QuantityInventory: QuantityInventory,
        //        LoCode: LoCode,
        //        ExpiryDate: ExpiryDate,
        //        TaxFee: TaxFee,
        //        Istab: Istab
        //    }

        //    ClickEventHandler2(true, "/ProductInvoice/LoadProductItemNT", ".detailList2", formdata, function () {
        //        if (tab3 == 0 && tab1 == 1 && tab2 == 0) {
        //            $('#ProductItemCount1').val($('#listOrderDetail1 .detailList1 tr').length);
        //        } else if (tab3 == 0 && tab1 == 0 && tab2 == 1) {
        //            $('#ProductItemCount2').val($('#listOrderDetail2.detailList2 tr').length);
        //        } else {
        //            $('#ProductItemCount3').val($('#listOrderDetail3 .detailList3 tr').length);
        //        }

        //        $.mask.definitions['~'] = '[+-]';
        //        $('.input-mask-date').mask('99/99/9999');
        //        LoadNumberInput();

        //        if (tab3 == 0 && tab1 == 1 && tab2 == 0) {
        //            tinh_tong_tien1();
        //        } else if (tab3 == 0 && tab1 == 0 && tab2 == 1) {
        //            tinh_tong_tien2();
        //        } else {
        //            tinh_tong_tien3();
        //        }

        //    });

        //}

        $('#productSelectList').radComboBox({
            colTitle: 'ID, Hình, Tên sản phẩm, Lô, HSD, Xuất xứ, Tồn kho',
            colValue: 1,
            colImage: 2,
            colHide: '1',
            colSize: '0px,50px,275px,70px,70px,100px,70px',
            colClass: ',,',
            width: 600,
            height: 300,
            boxSearch: false,
            colSearch: 2
        });
        //Hiển thị giá và tính thành tiền khi chọn sản phẩm


        $('#productSelectList').on('change', function () {
            var $this = $(this);
            var selected = $this.find("option:selected");

            if (selected.val() == '' || $('#product_item_' + selected.val()).length > 0)
                return;
            if (tab3 == 0 && tab1 == 1 && tab2 == 0 && tab4 == 0 && tab5 == 0 && tab6 == 0) {
                var OrderNo = $('.detailList1 tr').length;
                var Istab = 1;
            } else if (tab3 == 0 && tab1 == 0 && tab2 == 1 && tab4 == 0 && tab5 == 0 && tab6 == 0) {
                var OrderNo = $('.detailList2 tr').length;
                var Istab = 2;
            } else if (tab3 == 1 && tab1 == 0 && tab2 == 0 && tab4 == 0 && tab5 == 0 && tab6 == 0) {
                var OrderNo = $('.detailList3 tr').length;
                var Istab = 3;
            } else if (tab3 == 0 && tab1 == 0 && tab2 == 0 && tab4 == 1 && tab5 == 0 && tab6 == 0) {
                var OrderNo = $('.detailList4 tr').length;
                var Istab = 4;
            } else if (tab3 == 0 && tab1 == 0 && tab2 == 0 && tab4 == 0 && tab5 == 1 && tab6 == 0) {
                var OrderNo = $('.detailList5 tr').length;
                var Istab = 5;
            } else {
                var OrderNo = $('.detailList6 tr').length;
                var Istab = 6;
            }

            var ProductId = selected.data("product-id");
            var ProductName = selected.text();
            var Unit = selected.data("unit");
            var Quantity = 1;
            var Price = selected.data("price");
            var ProductType = selected.data("product-type");
            var ProductCode = selected.data("code");
            var QuantityInventory = selected.data("quantity-inventory");
            var LoCode = selected.data("lo-code");
            var ExpiryDate = selected.data("expiry-date");
            var TaxFee = selected.data("tax-fee");
            var formdata = {
                OrderNo: OrderNo,
                ProductId: ProductId,
                ProductName: ProductName,
                Unit: Unit,
                Quantity: Quantity,
                Price: Price,
                ProductCode: ProductCode,
                ProductType: ProductType,
                QuantityInventory: QuantityInventory,
                LoCode: LoCode,
                ExpiryDate: ExpiryDate,
                TaxFee: TaxFee,
                Istab: Istab
            };

            //Thêm dòng mới
            ClickEventHandler2(true, "/ProductInvoice/LoadProductItemNT", ".detailList2", formdata, function () {
                if (tab3 == 0 && tab1 == 1 && tab2 == 0 && tab4 == 0 && tab5 == 0 && tab6 == 0) {
                    $('#ProductItemCount1').val($('#listOrderDetail1 .detailList1 tr').length);
                } else if (tab3 == 0 && tab1 == 0 && tab2 == 1 && tab4 == 0 && tab5 == 0 && tab6 == 0) {
                    $('#ProductItemCount2').val($('#listOrderDetail2.detailList2 tr').length);
                } else if (tab3 == 1 && tab1 == 0 && tab2 == 0 && tab4 == 0 && tab5 == 0 && tab6 == 0) {
                    $('#ProductItemCount3').val($('#listOrderDetail3 .detailList3 tr').length);
                } else if (tab3 == 0 && tab1 == 0 && tab2 == 0 && tab4 == 1 && tab5 == 0 && tab6 == 0) {
                    $('#ProductItemCount4').val($('#listOrderDetail4 .detailList4 tr').length);
                } else if (tab3 == 0 && tab1 == 0 && tab2 == 0 && tab4 == 0 && tab5 == 1 && tab6 == 0) {
                    $('#ProductItemCount5').val($('#listOrderDetail5 .detailList5 tr').length);
                } else {
                    $('#ProductItemCount6').val($('#listOrderDetail6 .detailList6 tr').length);
                }

                $.mask.definitions['~'] = '[+-]';
                $('.input-mask-date').mask('99/99/9999');
                LoadNumberInput();
                if (tab3 == 0 && tab1 == 1 && tab2 == 0 && tab4 == 0 && tab5 == 0 && tab6 == 0) {
                    tinh_tong_tien1();
                } else if (tab3 == 0 && tab1 == 0 && tab2 == 1 && tab4 == 0 && tab5 == 0 && tab6 == 0) {
                    tinh_tong_tien2();
                } else if (tab3 == 1 && tab1 == 0 && tab2 == 0 && tab4 == 0 && tab5 == 0 && tab6 == 0) {
                    tinh_tong_tien3();
                } else if (tab3 == 0 && tab1 == 0 && tab2 == 0 && tab4 == 1 && tab5 == 0 && tab6 == 0) {
                    tinh_tong_tien4();
                } else if (tab3 == 0 && tab1 == 0 && tab2 == 0 && tab4 == 0 && tab5 == 1 && tab6 == 0) {
                    tinh_tong_tien5();
                } else {
                    tinh_tong_tien6();
                }

            });
        });

       function getOrderNO() {
            if (tab3 == 0 && tab1 == 1 && tab2 == 0 && tab4 == 0 && tab5 == 0 && tab6 == 0) {
                var OrderNo = $('.detailList1 tr').length;
            } else if (tab3 == 0 && tab1 == 0 && tab2 == 1 && tab4 == 0 && tab5 == 0 && tab6 == 0) {
                var OrderNo = $('.detailList2 tr').length;
            } else if (tab3 == 1 && tab1 == 0 && tab2 == 0 && tab4 == 0 && tab5 == 0 && tab6 == 0) {
                var OrderNo = $('.detailList3 tr').length;
            } else if (tab3 == 0 && tab1 == 0 && tab2 == 0 && tab4 == 1 && tab5 == 0 && tab6 == 0) {
                var OrderNo = $('.detailList4 tr').length;
            } else if (tab3 == 0 && tab1 == 0 && tab2 == 0 && tab4 == 0 && tab5 == 1 && tab6 == 0) {
                var OrderNo = $('.detailList5 tr').length;
            } else {
                var OrderNo = $('.detailList6 tr').length;
            }
            return OrderNo;
        }
        $(document).ready(function () {
            //alert("da goi vao document ready");



        });

    </script>
